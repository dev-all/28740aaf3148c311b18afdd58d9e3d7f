var baseUrl = document.location.origin ? document.location.origin : window.location.protocol + "//" + window.location.hostname + (window.location.port ? ":" + window.location.port : ""); function uploadFile(e, a, t) { $.ajax({ url: baseUrl + "/Home/AjaxSendFile", type: "post", data: e, processData: !1, contentType: !1, xhr: function () { var e = $.ajaxSettings.xhr(); return e.upload && (e.upload.addEventListener("progress", function (e) { var s = Math.round(e.loaded / e.total * 100); $("#progress-bar-" + a).css({ width: s + "%" }), $("#progress-bar-" + a).text(t.files[0].name + " - " + s + "%") }, !1), e.addEventListener("abort", function () { $("#progress-bar-" + a).closest(".progress").fadeOut(3e3, function () { $(this).remove() }) }, !1), e.addEventListener("loadend", function () { $("#progress-bar-" + a).closest(".progress").fadeOut(6e3, function () { $(this).remove() }) }, !1), e.addEventListener("error", function () { $("#progress-bar-" + a).closest(".progress").addClass("progress-error").find("status-count").text("Error") }, !1), e.addEventListener("timeout", function (e) { $("#progress-bar-" + a).closest(".progress").addClass("progress-timedout").find("status-count").text("Timed Out") }, !1)), e } }) } function Converts(e) { var a = Math.floor(Math.log(e) / Math.log(1024)); return 1 * (e / Math.pow(1024, a)).toFixed(2) + " " + ["B", "KB", "MB", "GB", "TB", "PB", "EB", "ZB", "YB"][a] } jQuery, jQuery.isEmpty = function (e) { var a = !1; return null != e && "" !== e || (a = !0), "number" == typeof e && isNaN(e) && (a = !0), e instanceof Date && isNaN(Number(e)) && (a = !0), a }, $(function () { $("#expiration").bootstrapMaterialDatePicker({ format: "DD/MM/YYYY", time: !1 }), $(".SendFile").on("click", function (e, a) { if (0 != $(".item-archivo-adjunto").length) { var t; for (a = 0; t = $("input:file")[a]; ++a)if (t.files.length > 0) { t.name.substr(-1); var s = new FormData, i = jQuery.isEmpty($("#" + t.name).attr("data-expiration")) ? " " : $("#" + t.name).attr("data-expiration"), l = jQuery.isEmpty($("#" + t.name).attr("data-notes")) ? " " : $("#" + t.name).attr("data-notes"), o = jQuery.isEmpty($("#" + t.name).attr("data-isUnique")) ? " " : $("#" + t.name).attr("data-isUnique"); $("#" + t.name).prop("files") && s.append("dataFile", $("#" + t.name).prop("files")[0]), s.append("dataExpiration", i), s.append("dataNotes", l), s.append("dataIsUnique", o), s.append("Id", $("#Id").val()), s.append("IdCustomer", $("#IdCustomer").val()), s.append("jobname", $("#JobName").val()); var n = '<div class="progress" id="' + a + '"><div id="progress-bar-' + a + '" class="progress-bar progress-bar-striped bg-success" role="progressbar" style="width: 25%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div></div> </br>'; $(".progress-container").append(n), uploadFile(s, a, t) } } }); $(".adj-archivo").on("click", function (e) { e.preventDefault(), e.stopPropagation(); var a = $("input:file").length + 1, t = [], s = ""; jQuery.isEmpty($("#expiration").val()) || (s = $("#expiration").val()); var i = ""; jQuery.isEmpty($("#notes").val()) || (i = $("#notes").val()); var l = "0"; $("#isUnique").is(":checked") && (l = 1); for (var o, n = 0; o = $("input:file")[n]; ++n)if (0 == o.files.length) o.remove(); else { var r = o.name.substr(-1); t.push(r) } $(".inputs-hiddens").append("<input id='file" + a + "' name='file" + a + "' data-expiration='" + s + "' ' data-notes='" + i + "' ' data-isUnique='" + l + '\' type="file" value="" />'), $("#file" + a).click() }), $(".inputs-hiddens").on("change", "input:file", function (e) { e.preventDefault(); var a = $(this)[0].files[0].name, t = $(this)[0].files[0].size, s = $(this)[0].files[0].type, i = $(this).prop("id"); $(".list-file-all").append('<li class="list-group-item d-flex justify-content-between lh-condensed item-archivo-adjunto"><div><h6 class="my-0"><font style="vertical-align: inherit;">' + a + '</font></h6><small class="text-muted"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' + Converts(t) + " . " + s + '</font></font></small></div><span class="text-muted"><font style="vertical-align: inherit;"><button type="button" data-id="' + i + '" class="pull-right btn btn-danger btn-xs delete-file"><i class="fa fa-remove"></i></button></font ></span > </li > '), $(".lenfile").html($(".list-file-all").children().length), $(".list-file-all").children().length > 0 ? ($(".cordJobFile").css("width", "45em"), $(".col-file").removeClass("dn").addClass("db"), $(".Yourfiles").removeClass("invisible").addClass("visible"), $(".col-Job").removeClass("col-md-12").addClass("col-md-6"), $(".col-file").removeClass("col-md-0").addClass("col-md-6")) : ($(".cordJobFile").css("width", "20em"), $(".col-Job").removeClass("col-md-6").addClass("col-md-12"), $(".col-file").removeClass("col-md-0").addClass("col-md-6"), $(".col-file").removeClass("db").addClass("dn"), $(".Yourfiles").removeClass("visible").addClass("invisible")) }), $(".list-file-all").on("click", ".delete-file", function (e) { e.preventDefault(), e.stopPropagation(); var a = $(this).data("id"); 1 == document.querySelectorAll(".inputs-hiddens")[0].children.length && $(".inputs-hiddens").empty(), $("#" + a).remove(), $(this).closest(".item-archivo-adjunto").remove(), $(".lenfile").html($(".list-file-all").children().length), $(".list-file-all").children().length > 0 ? ($(".cordJobFile").css("width", "45em"), $(".col-file").removeClass("dn").addClass("db"), $(".Yourfiles").removeClass("invisible").addClass("visible"), $(".col-Job").removeClass("col-md-12").addClass("col-md-6"), $(".col-file").removeClass("col-md-0").addClass("col-md-6")) : ($(".cordJobFile").css("width", "20em"), $(".col-Job").removeClass("col-md-6").addClass("col-md-12"), $(".col-file").removeClass("col-md-0").addClass("col-md-6"), $(".col-file").removeClass("db").addClass("dn"), $(".Yourfiles").removeClass("visible").addClass("invisible")) }) });